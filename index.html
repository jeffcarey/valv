<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-hierarchy.v1.min.js"></script>
    <script src="https://d3js.org/d3-array.v1.min.js"></script>
    <script src="https://d3js.org/d3-scale.v1.min.js"></script>
    <style>
    body {
        margin: 0;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left:0;
        background-color: #000;
    }
    </style>
</head>

<body>
<script>

var width = 821;
var height = 500;

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)

var treemapNode = svg.append("g")
    .attr("transform", "translate("+(width/2-180)+","+(height/2-180)+")")

var colors = d3.schemeCategory10;

var currentLanguageIndex = 0;

d3.json("example_data.json", function(error, data){
    if (error) return console.error(error);

    var node = d3.hierarchy(data[currentLanguageIndex], function(d){
        return d.categories || d.subcategories || d.articles || null;
    })
        .count()
        .sort(function(a, b) { return b.height - a.height; })

    var treemap = d3.treemap()
        .tile(d3.treemapSquarify.ratio(1))
        .size([360, 360])
        .padding(1.8);

    var root = treemap(node)
    root.children.forEach(function(category, i){
        category.children.forEach(function(subcategory){
            subcategory.children.forEach(function(article){
                article.categoryIndex = i;
            })
        })
    })
    leaves = root.leaves();

    var sel = treemapNode.selectAll(".treeRect")
        .data(leaves);

    sel.exit().remove();
    sel.enter().append("rect").attr("class", "treeRect")
        .merge(sel)
        .attr("x", function(d){ return d.x0 })
        .attr("width", function(d){ return d.x1 - d.x0 })
        .attr("y", function(d){ return d.y0 })
        .attr("height", function(d){ return d.y1 - d.y0 })
        .style("fill", function(d){
            var c = d3.hsl(colors[d.categoryIndex]);
            c.l = d.data.quality/2;
            return c.toString();

        })
})





    </script>
</body>
